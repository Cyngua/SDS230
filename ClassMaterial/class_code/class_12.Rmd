---
title: "Class 12 notes and code"
output:
  html_document: default
  pdf_document: 
   fig_width: 7
   fig_height: 5
editor_options: 
  chunk_output_type: console
---





$\\$



<!--  Please run the code in the  R chunk below once. This will install some packages and download data and images needed for these exercises.  -->

```{r message=FALSE, warning = FALSE, echo = FALSE, eval = FALSE}

# makes sure you have all the packages we have used in class installed
#SDS230::update_installed_packages()

# install.packages("gapminder")


```




```{r setup, include=FALSE}

# install.packages("latex2exp")

library(latex2exp)

library(dplyr)


#options(scipen=999)


knitr::opts_chunk$set(echo = TRUE)

# hide all plot output - useful for printing the code
# knitr::opts_chunk$set(fig.show='hide')

set.seed(123)

```






$\\$






## Overview


 * ggplot review
 * ggplot bonus features



$\\$








## Part 1: Review of ggplot

ggplot2 is a R package created by Hadley Wickham that implements Leland Wilkinson's concept of a grammar of graphics. In the grammar of graphics (and ggplot) data graphics are composed of: 

- a frame
- glyphs
- scales and guides
- facets
- layers
- themes
 


$\\$






### Part 1.1: ggplot frames, geoms (glyphs), and scales


Let's use the gapminder data to construct a visualization using this grammar that has:

1. A basic frame constructed from called the `ggplot()` function

2. A geom of points where:
  - `gdpPercap` is mapped to the x position
  - `lifeExp` is mapped to the y position
  - `continent` is mapped to color

3. Transform the scales so that 
  - The x values are on a $log_10$ scale
  - The color scale using a different qualitative color brewer pallet


```{r ggplots1}

library(ggplot2)
library(gapminder)







```






$\\$






### Part 1.2: ggplot facets, layers and themes


Let's continue to use the gapminder data to construct a visualization using this grammar that has:

1. The gapminder data filtered to only have data from France, Haiti and the United States

2. A geom of line where:
  - `year` is mapped to the x position
  - `lifeExp` is mapped to the y position

3. Faceting based on the country

4. A second glyph layer with a red vertical line at the year 1969

5. The Wall Street Journal theme from the ggthemes package



```{r ggplots2}


library(ggthemes)









```






$\\$




### Part 1.3: 


We can also create:
- Text as a glyph using `geom_text()`
- Annotations using `annotate(geom_type, geom_properties)` 
- Manually modify the theme using `theme()` with different arguments


Let's create a plot where:

1. It only has data from 2007

2. A text glyph with the following properties:
  - `gdpPercap` is mapped to the x position
  - `lifeExp` is mapped to the y position
  - `continent` is mapped to color
  - `country` is mapped to the text label
  
3. Let's use a log 10 scale

4. Let's turn off the legend by modifying the theme

5. Let's add a text annotation with the following attributes
  - x = 600
  - y = 80
  - label = "this plot is messy :("


```{r ggplot3}










```




$\\$





## Part 2: Additional ggplot themes and features




$\\$




### Part 2.1: Plotly 


The plotly package can be used to create interactive visualizations. 

Let's recreate an interactive version of the gapminder data from 2007 using a `geom_point()` and:

  - `gdpPercap` is mapped to the x position
  - `lifeExp` is mapped to the y position
  - `continent` is mapped to color
  - `country` is mapped to the name

  
We will save our plot to an object `g` and then we can use `ggplotly(g)` to create an interactive visualization. 



```{r, plotly}

library(gapminder)
library(plotly)









```





$\\$






### Part 2.2: emojis


Everyone loves emojis! 

Let's use the motor trends car data to plot miles per gallon (mpg) as a function of weight using the proper glyph.



```{r, emoji}

#install.packages("emojifont")

library(emojifont)

load.emojifont('OpenSansEmoji.ttf')


ggplot(mtcars, aes(x = wt, y = mpg, label = emoji("car"), col = factor(cyl))) +  	  	
	geom_text(family="OpenSansEmoji", size=6)  +    
	xlab("Weight") +   
	ylab("Miles per Gallon") + 
	theme_classic()


# another option that sometimes works
# devtools::install_github("dill/emoGG")
# library(emoGG)
# ggplot(mtcars, aes(wt, mpg)) + 
#   geom_emoji(emoji="1f697")



```






$\\$






### Part 2.3: animations


We can crate animated gifs too...



```{r, animations}


#install.packages('png')
#install.packages('gifski')
#install.packages('gganimate')


# library(gganimate)
# 
# 
# ggplot(gapminder, aes(gdpPercap, lifeExp, size = pop, colour = country)) +
#   geom_point(alpha = 0.7, show.legend = FALSE) +
#   scale_colour_manual(values = country_colors) +
#   scale_size(range = c(2, 12)) +
#   scale_x_log10() +
#   facet_wrap(~continent) +
#   # Here comes the gganimate specific bits
#   labs(title = 'Year: {frame_time}', x = 'GDP per capita', y = 'life expectancy') +
#   transition_time(year) +
#   ease_aes('linear')



```




























